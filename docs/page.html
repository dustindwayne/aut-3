<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AUT-3 Document Viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <style>
    :root {
      --bg: #f5f5f7;
      --bg-panel: #ffffff;
      --bg-sidebar: #0f172a;
      --border-subtle: #e5e7eb;
      --text: #0f172a;
      --text-muted: #6b7280;
      --sidebar-text: #e5e7eb;
      --sidebar-muted: #94a3b8;
      --accent: #3b82f6;
      --accent-soft: rgba(59,130,246,0.15);
      --radius-lg: 20px;
      --radius-md: 12px;
      --shadow-soft: 0 24px 60px rgba(15,23,42,0.18);
      --transition-fast: 150ms ease-out;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #020617;
        --bg-panel: #020617;
        --bg-sidebar: #020617;
        --border-subtle: #1e293b;
        --text: #e5e7eb;
        --text-muted: #9ca3af;
        --sidebar-text: #e5e7eb;
        --sidebar-muted: #64748b;
        --accent: #38bdf8;
        --accent-soft: rgba(56,189,248,0.18);
        --shadow-soft: 0 32px 70px rgba(15,23,42,0.9);
      }
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, rgba(56,189,248,0.1), transparent 55%),
                  radial-gradient(circle at bottom, rgba(37,99,235,0.12), transparent 55%),
                  var(--bg);
      color: var(--text);
      display: flex;
      justify-content: center;
      align-items: stretch;
      padding: 20px;
    }

    .app {
      width: 100%;
      max-width: 1220px;
      border-radius: 28px;
      overflow: hidden;
      background: linear-gradient(135deg, rgba(15,23,42,0.7), rgba(15,23,42,0.3));
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-soft);
      display: grid;
      grid-template-columns: 260px minmax(0, 1fr);
    }

    @media (max-width: 880px) {
      .app {
        grid-template-columns: minmax(0, 1fr);
      }
      .sidebar {
        position: sticky;
        top: 0;
        z-index: 5;
      }
    }

    .sidebar {
      background: radial-gradient(circle at top, rgba(56,189,248,0.16), transparent 55%),
                  var(--bg-sidebar);
      color: var(--sidebar-text);
      padding: 18px 18px 20px;
      display: flex;
      flex-direction: column;
      gap: 14px;
      border-right: 1px solid rgba(15,23,42,0.7);
    }

    .side-header {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .side-label {
      font-size: 11px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--sidebar-muted);
    }

    .side-title {
      font-size: 18px;
      font-weight: 600;
      letter-spacing: 0.06em;
      text-transform: uppercase;
    }

    .side-subtitle {
      font-size: 12px;
      color: var(--sidebar-muted);
    }

    .nav-list {
      margin: 8px 0 0;
      padding: 0;
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 13px;
    }

    .nav-item {
      border-radius: 9px;
      overflow: hidden;
    }

    .nav-link {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 6px 9px;
      text-decoration: none;
      color: var(--sidebar-muted);
      transition: background var(--transition-fast), color var(--transition-fast),
                  transform var(--transition-fast);
      border-radius: 9px;
    }

    .nav-link span {
      pointer-events: none;
    }

    .nav-link small {
      font-size: 10px;
      opacity: 0.7;
    }

    body:not(.nohover) .nav-link:hover {
      background: rgba(15,23,42,0.9);
      color: var(--sidebar-text);
      transform: translateX(1px);
    }

    .nav-link.active {
      background: linear-gradient(90deg, var(--accent-soft), transparent);
      color: var(--sidebar-text);
      border-left: 2px solid var(--accent);
    }

    .side-footer {
      margin-top: auto;
      font-size: 11px;
      color: var(--sidebar-muted);
      border-top: 1px solid rgba(15,23,42,0.75);
      padding-top: 8px;
      display: flex;
      justify-content: space-between;
      gap: 6px;
      flex-wrap: wrap;
    }

    .side-footer a {
      color: var(--accent);
      text-decoration: none;
    }

    .content-shell {
      background: var(--bg-panel);
      padding: 18px 22px 22px;
      overflow: auto;
    }

    @media (max-width: 640px) {
      body {
        padding: 10px;
      }
      .content-shell {
        padding: 16px 14px 18px;
      }
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      margin-bottom: 10px;
    }

    .crumbs {
      font-size: 11px;
      color: var(--text-muted);
    }

    .crumbs a {
      color: var(--accent);
      text-decoration: none;
    }

    .file-label {
      font-size: 11px;
      color: var(--text-muted);
      padding: 3px 9px;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      background: rgba(148,163,184,0.08);
    }

    .doc {
      border-radius: 18px;
      border: 1px solid var(--border-subtle);
      padding: 16px 18px 20px;
      background: radial-gradient(circle at top, rgba(15,23,42,0.05), transparent 60%),
                  rgba(255,255,255,0.94);
      max-width: 920px;
      margin: 0 auto;
      line-height: 1.55;
      font-size: 14px;
    }

    @media (prefers-color-scheme: dark) {
      .doc {
        background: radial-gradient(circle at top, rgba(56,189,248,0.1), transparent 60%),
                    rgba(15,23,42,0.97);
      }
    }

    .doc h1, .doc h2, .doc h3, .doc h4 {
      margin-top: 18px;
      margin-bottom: 8px;
    }

    .doc h1 { font-size: 22px; }
    .doc h2 { font-size: 18px; }
    .doc h3 { font-size: 15px; }

    .doc p {
      margin: 8px 0;
    }

    .doc code {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12px;
      background: rgba(15,23,42,0.06);
      padding: 1px 4px;
      border-radius: 4px;
    }

    .doc pre {
      background: rgba(15,23,42,0.88);
      color: #e5e7eb;
      padding: 10px 12px;
      border-radius: 10px;
      overflow-x: auto;
      font-size: 12px;
    }

    .doc a {
      color: var(--accent);
    }

    .status {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 6px;
    }

    .error {
      color: #ef4444;
    }
  </style>
</head>
<body>
  <div class="app">
    <aside class="sidebar">
      <div class="side-header">
        <div class="side-label">AUT-3 / Docs</div>
        <div class="side-title">Navigation</div>
        <div class="side-subtitle">Select a chapter, spec, or legal text. Markdown is rendered client-side from the repository.</div>
      </div>

      <ul class="nav-list" id="nav-list"></ul>

      <div class="side-footer">
        <span>Spec: Volumetric photonic compute–memory.</span>
        <span><a href="index.html">Back to overview</a></span>
      </div>
    </aside>

    <main class="content-shell">
      <div class="top-bar">
        <div class="crumbs">
          <a href="index.html">AUT-3</a> · <span id="crumb-label">Document</span>
        </div>
        <div id="file-label" class="file-label"></div>
      </div>
      <div class="status" id="status">Loading…</div>
      <article id="content" class="doc"></article>
    </main>
  </div>

  <script>
    // mark touch devices to soften hover
    if ('ontouchstart' in window) {
      document.body.classList.add('nohover');
    }

    const docs = [
      { id: "master", label: "Master Specification", file: "AUT3_Master_Specification.md", group: "Core" },
      { id: "pub", label: "Defensive Publication", file: "defensive-publication/AUT3_Defensive_Publication.md", group: "Core" },
      { id: "claims", label: "Claims Appendix", file: "defensive-publication/AUT3_Claims_Appendix.md", group: "Core" },

      { id: "arch", label: "Architecture Overview", file: "spec/01_Architecture_Overview.md", group: "Chapters" },
      { id: "state", label: "State Model", file: "spec/03_State_Model.md", group: "Chapters" },
      { id: "compute", label: "Compute Model", file: "spec/04_Compute_Model.md", group: "Chapters" },
      { id: "memory", label: "Memory Model", file: "spec/05_Memory_Model.md", group: "Chapters" },
      { id: "control", label: "Control Plane", file: "spec/06_Control_Plane_and_Programming.md", group: "Chapters" },
      { id: "mesh", label: "Node Mesh & Scaling", file: "spec/07_Node_Mesh_and_Scaling.md", group: "Chapters" },
      { id: "faults", label: "Fault Tolerance", file: "spec/08_Fault_Tolerance_and_Reliability.md", group: "Chapters" },
      { id: "perf", label: "Performance & Limits", file: "spec/09_Performance_and_Limits.md", group: "Chapters" },
      { id: "ai", label: "AI Relevance & Use Cases", file: "spec/10_AI_Relevance_and_Use_Cases.md", group: "Chapters" },
      { id: "impl", label: "Implementation Notes", file: "spec/11_Implementation_Notes.md", group: "Chapters" },
      { id: "gloss", label: "Glossary", file: "spec/12_Glossary.md", group: "Chapters" },
    ];

    // group by group field for sidebar ordering
    function buildNav(currentFile) {
      const nav = document.getElementById('nav-list');
      nav.innerHTML = '';

      const groups = ["Core", "Chapters"];
      groups.forEach(group => {
        const headerLi = document.createElement('li');
        headerLi.textContent = group;
        headerLi.style.fontSize = "11px";
        headerLi.style.textTransform = "uppercase";
        headerLi.style.letterSpacing = "0.12em";
        headerLi.style.marginTop = group === "Core" ? "4px" : "10px";
        headerLi.style.color = "var(--sidebar-muted)";
        nav.appendChild(headerLi);

        docs.filter(d => d.group === group).forEach(doc => {
          const li = document.createElement('li');
          li.className = "nav-item";
          const link = document.createElement('a');
          link.className = "nav-link";
          link.href = "page.html?file=" + encodeURIComponent(doc.file);
          if (doc.file === currentFile) {
            link.classList.add('active');
          }
          const left = document.createElement('span');
          left.textContent = doc.label;
          const right = document.createElement('small');
          right.textContent = doc.group === "Core" ? "core" : "chapter";
          link.appendChild(left);
          link.appendChild(right);
          li.appendChild(link);
          nav.appendChild(li);
        });
      });
    }

    function getParam(name) {
      const params = new URLSearchParams(window.location.search);
      return params.get(name);
    }

    const fileParam = getParam('file') || "AUT3_Master_Specification.md";
    const currentDoc = docs.find(d => d.file === fileParam);
    const crumbLabel = document.getElementById('crumb-label');
    const fileLabel = document.getElementById('file-label');
    const statusEl = document.getElementById('status');
    const contentEl = document.getElementById('content');

    buildNav(fileParam);

    if (currentDoc) {
      crumbLabel.textContent = currentDoc.label;
      fileLabel.textContent = currentDoc.file;
    } else {
      crumbLabel.textContent = "Document";
      fileLabel.textContent = fileParam;
    }

    const url = "../" + fileParam;

    statusEl.textContent = "Loading " + fileParam + " …";

    fetch(url)
      .then(r => {
        if (!r.ok) throw new Error("HTTP " + r.status + " for " + url);
        return r.text();
      })
      .then(md => {
        statusEl.textContent = "";
        contentEl.innerHTML = marked.parse(md);
      })
      .catch(err => {
        statusEl.innerHTML = "<span class='error'>Error loading document.</span>";
        contentEl.innerHTML =
          "<p>Failed to load:</p><pre>" + fileParam + "</pre><p>" + err + "</p>";
      });
  </script>
</body>
</html>
