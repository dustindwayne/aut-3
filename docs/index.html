<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AUT-3 Documentation</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <style>
    :root {
      --bg: #f5f5f7;
      --panel-bg: #ffffff;
      --border-subtle: #e5e7eb;
      --border-strong: #d1d5db;
      --text: #020617;
      --text-muted: #6b7280;
      --accent: #2563eb;
      --accent-soft: rgba(37,99,235,0.08);
      --radius-lg: 18px;
      --radius-md: 10px;
      --shadow: 0 18px 40px rgba(15,23,42,0.12);
      --transition: 140ms ease-out;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #020617;
        --panel-bg: #020617;
        --border-subtle: #1f2933;
        --border-strong: #111827;
        --text: #e5e7eb;
        --text-muted: #9ca3af;
        --accent: #38bdf8;
        --accent-soft: rgba(56,189,248,0.14);
        --shadow: 0 26px 60px rgba(15,23,42,0.95);
      }
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
      background:
        radial-gradient(circle at top left, rgba(56,189,248,0.12), transparent 60%),
        radial-gradient(circle at bottom right, rgba(37,99,235,0.12), transparent 60%),
        var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: 18px;
      display: flex;
      justify-content: center;
      align-items: stretch;
    }

    .shell {
      width: 100%;
      max-width: 1200px;
      background: var(--panel-bg);
      border-radius: 24px;
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow);
      display: grid;
      grid-template-columns: 260px minmax(0, 1fr);
      overflow: hidden;
    }

    @media (max-width: 880px) {
      .shell {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .side {
      background:
        radial-gradient(circle at top, rgba(56,189,248,0.12), transparent 60%),
        linear-gradient(180deg, #020617, #020617);
      color: #e5e7eb;
      padding: 18px 18px 20px;
      display: flex;
      flex-direction: column;
      gap: 14px;
      border-right: 1px solid rgba(15,23,42,0.75);
    }

    .side-header {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .side-label {
      font-size: 11px;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: #9ca3af;
    }

    .side-title {
      font-size: 18px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .side-sub {
      font-size: 12px;
      color: #9ca3af;
    }

    .side-section-title {
      margin-top: 8px;
      font-size: 11px;
      color: #9ca3af;
      text-transform: uppercase;
      letter-spacing: 0.14em;
    }

    .nav {
      margin: 4px 0 0;
      padding: 0;
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 13px;
    }

    .nav-button {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 6px 9px;
      border-radius: 9px;
      border: 1px solid transparent;
      background: transparent;
      color: #cbd5f5;
      text-align: left;
      cursor: pointer;
      font: inherit;
      transition: background var(--transition), border-color var(--transition), transform var(--transition);
    }

    body:not(.nohover) .nav-button:hover {
      background: rgba(15,23,42,0.9);
      border-color: rgba(148,163,184,0.6);
      transform: translateX(1px);
    }

    .nav-button span {
      pointer-events: none;
    }

    .nav-button small {
      font-size: 10px;
      opacity: 0.7;
    }

    .nav-button.active {
      background: linear-gradient(90deg, var(--accent-soft), transparent);
      border-color: var(--accent);
      color: #e5e7eb;
    }

    .side-footer {
      margin-top: auto;
      font-size: 11px;
      color: #9ca3af;
      border-top: 1px solid rgba(15,23,42,0.85);
      padding-top: 8px;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .side-footer a {
      color: var(--accent);
      text-decoration: none;
    }

    .main {
      padding: 16px 18px 20px;
      background: var(--panel-bg);
      display: flex;
      flex-direction: column;
      gap: 8px;
      overflow: auto;
    }

    @media (max-width: 640px) {
      body {
        padding: 8px;
      }
      .main {
        padding: 14px 12px 18px;
      }
    }

    .top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
      font-size: 11px;
      color: var(--text-muted);
    }

    .crumbs a {
      color: var(--accent);
      text-decoration: none;
    }

    .file-tag {
      padding: 3px 9px;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      background: rgba(148,163,184,0.10);
      font-size: 11px;
    }

    .status {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .error {
      color: #ef4444;
    }

    .doc {
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-strong);
      background:
        radial-gradient(circle at top, rgba(15,23,42,0.06), transparent 60%),
        rgba(255,255,255,0.96);
      padding: 16px 18px 20px;
      max-width: 920px;
      margin: 0 auto;
      line-height: 1.55;
      font-size: 14px;
    }

    @media (prefers-color-scheme: dark) {
      .doc {
        background:
          radial-gradient(circle at top, rgba(56,189,248,0.14), transparent 60%),
          rgba(15,23,42,0.98);
      }
    }

    .doc h1, .doc h2, .doc h3, .doc h4 {
      margin-top: 18px;
      margin-bottom: 8px;
    }

    .doc h1 { font-size: 22px; }
    .doc h2 { font-size: 18px; }
    .doc h3 { font-size: 16px; }

    .doc p {
      margin: 8px 0;
    }

    .doc code {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12px;
      background: rgba(15,23,42,0.06);
      padding: 1px 4px;
      border-radius: 4px;
    }

    .doc pre {
      background: rgba(15,23,42,0.92);
      color: #e5e7eb;
      padding: 10px 12px;
      border-radius: 10px;
      overflow-x: auto;
      font-size: 12px;
    }

    .doc a {
      color: var(--accent);
    }
  </style>
</head>
<body>
  <div class="shell">
    <aside class="side">
      <div class="side-header">
        <div class="side-label">AUT-3</div>
        <div class="side-title">Docs</div>
        <div class="side-sub">
          Volumetric photonic compute–memory architecture. Choose a document to view the exact specification text rendered from the repo.
        </div>
      </div>

      <div class="side-section-title">Core</div>
      <ul class="nav" id="nav-core"></ul>

      <div class="side-section-title">Chapters</div>
      <ul class="nav" id="nav-chapters"></ul>

      <div class="side-footer">
        <span>Source: <a href="https://github.com/dustindwayne/aut-3">github.com/dustindwayne/aut-3</a></span>
        <span>Rendered client-side from Markdown.</span>
      </div>
    </aside>

    <main class="main">
      <div class="top">
        <div class="crumbs">
          <a href="#">AUT-3</a> · <span id="crumb-label">Master Specification</span>
        </div>
        <div id="file-label" class="file-tag"></div>
      </div>
      <div id="status" class="status">Loading…</div>
      <article id="content" class="doc"></article>
    </main>
  </div>

  <script>
    // soften hover on touch devices
    if ('ontouchstart' in window) {
      document.body.classList.add('nohover');
    }

    // documents mapping (file paths must match repo)
    const docs = [
      // Core
      { id: "master", label: "Master Specification", file: "AUT3_Master_Specification.md", group: "core" },
      { id: "pub", label: "Defensive Publication", file: "defensive-publication/AUT3_Defensive_Publication.md", group: "core" },
      { id: "claims", label: "Claims Appendix", file: "defensive-publication/AUT3_Claims_Appendix.md", group: "core" },

      // Chapters
      { id: "arch", label: "Architecture Overview", file: "spec/01_Architecture_Overview.md", group: "chapters" },
      { id: "state", label: "State Model", file: "spec/03_State_Model.md", group: "chapters" },
      { id: "compute", label: "Compute Model", file: "spec/04_Compute_Model.md", group: "chapters" },
      { id: "memory", label: "Memory Model", file: "spec/05_Memory_Model.md", group: "chapters" },
      { id: "control", label: "Control Plane", file: "spec/06_Control_Plane_and_Programming.md", group: "chapters" },
      { id: "mesh", label: "Node Mesh & Scaling", file: "spec/07_Node_Mesh_and_Scaling.md", group: "chapters" },
      { id: "faults", label: "Fault Tolerance", file: "spec/08_Fault_Tolerance_and_Reliability.md", group: "chapters" },
      { id: "perf", label: "Performance & Limits", file: "spec/09_Performance_and_Limits.md", group: "chapters" },
      { id: "ai", label: "AI Relevance & Use Cases", file: "spec/10_AI_Relevance_and_Use_Cases.md", group: "chapters" },
      { id: "impl", label: "Implementation Notes", file: "spec/11_Implementation_Notes.md", group: "chapters" },
      { id: "gloss", label: "Glossary", file: "spec/12_Glossary.md", group: "chapters" },
    ];

    function getParam(name) {
      const params = new URLSearchParams(window.location.search);
      return params.get(name);
    }

    // choose document by ?file=, fallback to master
    const requestedFile = getParam('file');
    const current = requestedFile
      ? docs.find(d => d.file === requestedFile) || docs[0]
      : docs[0];

    const statusEl = document.getElementById('status');
    const contentEl = document.getElementById('content');
    const crumbLabel = document.getElementById('crumb-label');
    const fileLabel = document.getElementById('file-label');

    crumbLabel.textContent = current.label;
    fileLabel.textContent = current.file;

    function buildNav() {
      const coreList = document.getElementById('nav-core');
      const chapterList = document.getElementById('nav-chapters');
      coreList.innerHTML = "";
      chapterList.innerHTML = "";

      docs.forEach(doc => {
        const li = document.createElement('li');
        const btn = document.createElement('button');
        btn.type = "button";
        btn.className = "nav-button" + (doc.file === current.file ? " active" : "");
        btn.onclick = () => {
          const basePath = window.location.pathname.split('/').slice(0, 2).join('/') + '/';
          const target = window.location.origin + basePath + "docs/index.html?file=" + encodeURIComponent(doc.file);
          window.location.href = target;
        };

        const left = document.createElement('span');
        left.textContent = doc.label;
        const right = document.createElement('small');
        right.textContent = doc.group === "core" ? "core" : "chapter";

        btn.appendChild(left);
        btn.appendChild(right);
        li.appendChild(btn);

        if (doc.group === "core") {
          coreList.appendChild(li);
        } else {
          chapterList.appendChild(li);
        }
      });
    }

    buildNav();

    // compute project root path: "/aut-3/"
    const pathParts = window.location.pathname.split('/'); // ["", "aut-3", "docs", "index.html"]
    const projectRoot = pathParts.slice(0, 2).join('/') + '/'; // "/aut-3/"
    const url = projectRoot + current.file;

    statusEl.textContent = "Loading " + current.file + " …";

    fetch(url)
      .then(r => {
        if (!r.ok) throw new Error("HTTP " + r.status + " for " + url);
        return r.text();
      })
      .then(md => {
        statusEl.textContent = "";
        contentEl.innerHTML = marked.parse(md);
      })
      .catch(err => {
        statusEl.innerHTML = "<span class='error'>Error loading document.</span>";
        contentEl.innerHTML =
          "<p>Failed to load:</p><pre>" + current.file + "</pre><p>" + err + "</p>";
      });
  </script>
</body>
</html>
